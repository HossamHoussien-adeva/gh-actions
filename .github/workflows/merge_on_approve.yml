# https://github.com/marketplace/actions/merge-branch
name: "Merge into develop on Approval"
on:
  pull_request_review:
    types: [submitted]
    branches-ignore: 'develop'

jobs:
  merge-if-approved:
    if: github.event.review.state == 'approved'
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master

    - name: Set Git config
      run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "Github Actions"

    - name: Merge PR into develop
      run: |
          git fetch --unshallow
          git checkout -b feature
          git branch --set-upstream-to=origin/${{github.event.pull_request.head.ref}} ${{github.event.pull_request.head.ref}}
          git pull
          git checkout develop
          git pull
          git merge ${{github.event.pull_request.head.ref}}
          git push
    # - name: Merge PR into develop
    #   uses: devmasx/merge-branch@master
    #   with:
    #     type: now
    #     target_branch: develop
    #     message: Merge PR into develop
    #     github_token: ${{ secrets.GH_TOKEN }}
    #   env:
    #     GITHUB_SHA: ${{ github.event.pull_request.head.sha }}